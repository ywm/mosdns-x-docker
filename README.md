# mosdns-x Docker é•œåƒ

ä¸€ä¸ªè‡ªåŠ¨æ„å»ºçš„ mosdns-x å®¹å™¨é•œåƒï¼Œå§‹ç»ˆè·Ÿéšä¸Šæ¸¸æœ€æ–°æºç ï¼š

- ğŸš€ **è‡ªåŠ¨è·Ÿè¸ªæ„å»º**ï¼šæ¯æ—¥è‡ªåŠ¨æ£€æµ‹ä¸Šæ¸¸æ›´æ–°å¹¶ä»æºç ç¼–è¯‘æœ€æ–°ç‰ˆæœ¬
- ğŸ“¦ **å¼€ç®±å³ç”¨**ï¼šå†…ç½®è§„åˆ™ä¸é…ç½®æ¨¡æ¿ï¼ˆæ¥è‡ª `pmkol/easymosdns`ï¼‰
- â° **å®šæ—¶æ›´æ–°è§„åˆ™**ï¼šé€šè¿‡ç¯å¢ƒå˜é‡é…ç½®å®šæ—¶ä»»åŠ¡ï¼Œè‡ªåŠ¨æ›´æ–° DNS è§„åˆ™
- ğŸ“Š **ä¾¿æ·æ—¥å¿—**ï¼šæ—¥å¿—è¾“å‡ºåˆ°æ ‡å‡†æµï¼Œä¾¿äº `docker logs` è§‚å¯Ÿ
- ğŸ”§ **åŠ¨æ€ Go ç‰ˆæœ¬**ï¼šè‡ªåŠ¨åŒ¹é…ä¸Šæ¸¸é¡¹ç›®è¦æ±‚çš„ Go ç‰ˆæœ¬è¿›è¡Œç¼–è¯‘

å‚è€ƒä¸Šæ¸¸é¡¹ç›®ï¼š[pmkol/mosdns-x](https://github.com/pmkol/mosdns-x) ã€[pmkol/easymosdns](https://github.com/pmkol/easymosdns)

---

## ç‰¹æ€§

- **è‡ªåŠ¨åŒ–æ„å»º**ï¼šGitHub Actions æ¯æ—¥è‡ªåŠ¨æ£€æµ‹ä¸Šæ¸¸ commitï¼Œæœ‰æ›´æ–°æ—¶è‡ªåŠ¨ç¼–è¯‘æ¨é€æ–°é•œåƒ
- **æºç ç¼–è¯‘**ï¼šç›´æ¥ä» mosdns-x æºç ç¼–è¯‘ï¼Œç¬¬ä¸€æ—¶é—´è·å¾—æœ€æ–°åŠŸèƒ½å’Œä¿®å¤
- **å†…ç½®æ¨¡æ¿**ï¼šé¢„ç½® `easymosdns` é…ç½®è‡³ `/etc/mosdns`ï¼Œè¿è¡Œå³ç”¨
- **å¯å®šåˆ¶æ›´æ–°**ï¼š`entrypoint.sh` ä¾æ®ç¯å¢ƒå˜é‡æ³¨å†Œ cron ä»»åŠ¡ï¼Œå®šæ—¶æ‰§è¡Œè§„åˆ™æ›´æ–°è„šæœ¬
- **æ ‡å‡†æ—¥å¿—**ï¼šå®šæ—¶ä»»åŠ¡ä¸æœåŠ¡æ—¥å¿—å†™å…¥å®¹å™¨æ ‡å‡†è¾“å‡ºï¼Œæ˜“äºé‡‡é›†ä¸æ’æŸ¥
- **è‡ªåŠ¨è¯ä¹¦æ›´æ–°**ï¼šå¯åŠ¨æ—¶è‡ªåŠ¨æ›´æ–° CA è¯ä¹¦ï¼Œç¡®ä¿ HTTPS è¿æ¥æ­£å¸¸

---

## å¿«é€Ÿå¼€å§‹

### ä½¿ç”¨ latest æ ‡ç­¾ï¼ˆæ¨èï¼‰

```sh
docker run -d \
  --name mosdns-x-docker \
  -p 53:53/udp -p 53:53/tcp \
  -v /your/config/dir:/etc/mosdns \
  -e crontab="0 4 * * *" \
  ghcr.io/ywm/mosdns-x-docker:latest
```

### ä» Docker Hub æ‹‰å–
```sh
docker pull ywmdocker/mosdns-x-docker:latest

docker run -d \
  --name mosdns-x-docker \
  -p 53:53/udp -p 53:53/tcp \
  -v /your/config/dir:/etc/mosdns \
  -e crontab="0 4 * * *" \
  ywmdocker/mosdns-x-docker:latest
```



### ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬æ ‡ç­¾

æ¯æ¬¡æ„å»ºä¼šç”Ÿæˆå¸¦æœ‰ä¸Šæ¸¸ commit hash å’Œæ—¥æœŸçš„æ ‡ç­¾ï¼Œä¾‹å¦‚ï¼š

```sh
docker run -d \
  --name mosdns-x-docker \
  -p 53:53/udp -p 53:53/tcp \
  -v /your/config/dir:/etc/mosdns \
  -e crontab="0 4 * * *" \
  ghcr.io/ywm/mosdns-x-docker:a1b2c3d_20260122
```



### ç¯å¢ƒå˜é‡è¯´æ˜

- `crontab`ï¼šå®šæ—¶è¿è¡Œ `/etc/mosdns/rules/update`ï¼ˆGitHub ç›´è¿æ›´æ–°ï¼‰
  - ç¤ºä¾‹ï¼š`"0 4 * * *"` è¡¨ç¤ºæ¯å¤©å‡Œæ™¨ 4 ç‚¹æ›´æ–°
- `crontabcdn`ï¼šå®šæ—¶è¿è¡Œ `/etc/mosdns/rules/update-cdn`ï¼ˆCDN åŠ é€Ÿæ›´æ–°ï¼‰
  - ç¤ºä¾‹ï¼š`"0 3 * * *"` è¡¨ç¤ºæ¯å¤©å‡Œæ™¨ 3 ç‚¹æ›´æ–°
- `TZ`ï¼šè®¾ç½®æ—¶åŒºï¼Œå½±å“ cron æ‰§è¡Œæ—¶é—´å’Œæ—¥å¿—æ—¶é—´
  - ç¤ºä¾‹ï¼š`"Asia/Shanghai"`

### æŸ¥çœ‹æ—¥å¿—

```sh
docker logs -f mosdns-x-docker
```

---

## Docker Compose ç¤ºä¾‹

```yaml
version: '3.8'

services:
  mosdns-x-docker:
    image: ghcr.io/ywm/mosdns-x-docker:latest
    container_name: mosdns-x-docker
    restart: unless-stopped
    ports:
      - "53:53/udp"
      - "53:53/tcp"
    volumes:
      - ./mosdns-config:/etc/mosdns
    environment:
      - crontab=0 4 * * *        # æ¯å¤© 4 ç‚¹æ›´æ–°è§„åˆ™
      - TZ=Asia/Shanghai         # è®¾ç½®æ—¶åŒº
```

---

## è¿è¡ŒåŸç†ä¸é»˜è®¤è¡Œä¸º

- **å…¥å£å‘½ä»¤**ï¼š`CMD ["/usr/bin/mosdns", "start", "--dir", "/etc/mosdns"]`
- **å…¥å£è„šæœ¬**ï¼š`entrypoint.sh` ä¼šï¼š
  1. è‡ªåŠ¨æ›´æ–° CA è¯ä¹¦
  2. æ£€æµ‹ `/etc/mosdns` æ˜¯å¦ä¸ºç©ºï¼Œç©ºåˆ™å¤åˆ¶é»˜è®¤é…ç½®
  3. åº”ç”¨è‡ªå®šä¹‰é…ç½®ï¼ˆå¦‚æœå­˜åœ¨ `/data/config.yaml`ï¼‰
  4. ç¡®ä¿æ›´æ–°è„šæœ¬å­˜åœ¨ä¸”å¯æ‰§è¡Œ
  5. æ ¹æ® `crontab` å’Œ `crontabcdn` ç¯å¢ƒå˜é‡å†™å…¥ `/etc/crontabs/root`
  6. å¯åŠ¨ `crond` å®ˆæŠ¤è¿›ç¨‹
  7. å¯åŠ¨ mosdns ä¸»æœåŠ¡
- **æ—¥å¿—**ï¼šå®šæ—¶ä»»åŠ¡è¾“å‡ºé‡å®šå‘åˆ° `/proc/1/fd/1`ï¼ˆstdoutï¼‰ï¼Œå¯ç”¨ `docker logs` æŸ¥çœ‹
- **å·**ï¼š`VOLUME /etc/mosdns`ï¼Œå»ºè®®æ˜ å°„å®¿ä¸»æœºè·¯å¾„ä»¥æŒä¹…åŒ–ä¸è‡ªå®šä¹‰é…ç½®

---

## é…ç½®ä¸è‡ªå®šä¹‰

### åŸºæœ¬é…ç½®

- **è¦†ç›–é…ç½®**ï¼šå°†æœ¬åœ°ç›®å½•æŒ‚è½½åˆ° `/etc/mosdns` å³å¯è¦†ç›–é»˜è®¤æ¨¡æ¿
- **å®šæ—¶æ›´æ–°**ï¼šä½¿ç”¨æ ‡å‡† cron è¡¨è¾¾å¼è®¾ç½® `crontab` æˆ– `crontabcdn`
  - æ¯å¤©å‡Œæ™¨ 4 ç‚¹ï¼š`0 4 * * *`
  - æ¯ 6 å°æ—¶ï¼š`0 */6 * * *`
  - æ¯å‘¨æ—¥å‡Œæ™¨ 3 ç‚¹ï¼š`0 3 * * 0`
- **æ—¶åŒº**ï¼šé•œåƒåŒ…å« `tzdata`ï¼Œå¯é€šè¿‡è®¾ç½® `TZ` ç¯å¢ƒå˜é‡å½±å“ cron ä¸æ—¥å¿—æ—¶é—´

### æŒ‚è½½ä¸æ•°æ®åˆå§‹åŒ–

- **é¦–æ¬¡å¯åŠ¨åˆå§‹åŒ–**ï¼šå½“æ‚¨å°†ä¸€ä¸ª**ç©ºç›®å½•**æŒ‚è½½åˆ°å®¹å™¨çš„ `/etc/mosdns` è·¯å¾„æ—¶ï¼Œå…¥å£è„šæœ¬ä¼šæ£€æµ‹åˆ°è¿™æ˜¯ä¸€ä¸ª"é¦–æ¬¡è¿è¡Œ"åœºæ™¯ã€‚å®ƒä¼šè‡ªåŠ¨å°†é•œåƒå†…é¢„ç½®çš„æ‰€æœ‰é»˜è®¤é…ç½®æ–‡ä»¶ã€è§„åˆ™åˆ—è¡¨å’Œæ›´æ–°è„šæœ¬å®Œæ•´åœ°å¤åˆ¶åˆ°æ‚¨æŒ‚è½½çš„ç›®å½•ä¸­ã€‚è¿™ç¡®ä¿äº†æœåŠ¡å¯ä»¥"å¼€ç®±å³ç”¨"ã€‚

- **æŒä¹…åŒ–ä¸è‡ªå®šä¹‰**ï¼šåœ¨é¦–æ¬¡å¯åŠ¨åï¼Œæ‚¨å¯ä»¥ç›´æ¥ä¿®æ”¹æŒ‚è½½ç›®å½•ä¸­çš„ä»»ä½•æ–‡ä»¶ï¼ˆå¦‚ `config.yaml` æˆ–è§„åˆ™æ–‡ä»¶ï¼‰ã€‚åç»­é‡å¯å®¹å™¨æ—¶ï¼Œè„šæœ¬ä¼šæ£€æµ‹åˆ°ç›®å½•éç©ºï¼Œå¹¶**è·³è¿‡**è‡ªåŠ¨å¤åˆ¶ï¼Œä»è€Œå®‰å…¨åœ°ä¿ç•™æ‚¨çš„æ‰€æœ‰è‡ªå®šä¹‰ä¿®æ”¹ã€‚

- **è‡ªåŠ¨æ¢å¤æ›´æ–°è„šæœ¬**ï¼šå¦‚æœæ‚¨ä¸å°å¿ƒåˆ é™¤äº† `/etc/mosdns/rules/update` æˆ– `/etc/mosdns/rules/update-cdn` è„šæœ¬ï¼Œå…¥å£è„šæœ¬ä¼šåœ¨æ¯æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹å¹¶æ¢å¤è¿™äº›æ–‡ä»¶ã€‚

- **é‡è¦æç¤º**ï¼šè¯·å§‹ç»ˆé€šè¿‡æŒ‚è½½**æ•´ä¸ªç›®å½•**ï¼ˆ`-v /your/config/dir:/etc/mosdns`ï¼‰çš„æ–¹å¼æ¥ç®¡ç†é…ç½®ã€‚**ä¸è¦åªæŒ‚è½½å•ä¸ªæ–‡ä»¶**ï¼Œè¿™ç§æ“ä½œä¼šé˜»æ­¢åˆå§‹åŒ–æµç¨‹ï¼Œå¯¼è‡´ `mosdns` å› ç¼ºå°‘å¿…è¦çš„ä¾èµ–æ–‡ä»¶è€Œå¯åŠ¨å¤±è´¥ã€‚

---

## è‡ªåŠ¨æ„å»ºè¯´æ˜

æœ¬é¡¹ç›®ä½¿ç”¨ GitHub Actions å®ç°è‡ªåŠ¨åŒ–æ„å»ºï¼š

1. **æ¯æ—¥æ£€æµ‹**ï¼šæ¯å¤©å‡Œæ™¨ 3 ç‚¹è‡ªåŠ¨è¿è¡Œæ£€æµ‹ä»»åŠ¡
2. **ç‰ˆæœ¬å¯¹æ¯”**ï¼š
   - è·å–ä¸Šæ¸¸ `pmkol/mosdns-x` çš„æœ€æ–° commit hash
   - è·å–ä¸Šæ¸¸ `go.mod` ä¸­è¦æ±‚çš„ Go ç‰ˆæœ¬
   - ä¸æœ¬åœ° `version` æ–‡ä»¶å¯¹æ¯”
3. **æŒ‰éœ€æ„å»º**ï¼š
   - å¦‚æœä¸Šæ¸¸æœ‰æ–° commitï¼Œè§¦å‘æ„å»º
   - ä½¿ç”¨æ£€æµ‹åˆ°çš„ Go ç‰ˆæœ¬è¿›è¡Œç¼–è¯‘
   - æ¨é€åˆ° GitHub Container Registry
4. **æ ‡ç­¾å‘½å**ï¼š
   - `latest`ï¼šå§‹ç»ˆæŒ‡å‘æœ€æ–°æ„å»º
   - `<commit-hash>_<date>`ï¼šç‰¹å®šç‰ˆæœ¬æ ‡ç­¾ï¼Œä¾‹å¦‚ `a1b2c3d_20260122`
5. **æäº¤ä¿¡æ¯**ï¼š
   - æ ¼å¼ï¼š`<ä¸Šæ¸¸æäº¤ä¿¡æ¯> - <çŸ­hash> - Go <ç‰ˆæœ¬>`
   - ä¾‹å¦‚ï¼š`feat: add new DNS plugin - a1b2c3d - Go 1.25.5`


---

## å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

### é…ç½®ä»å“ªé‡Œæ¥ï¼Ÿ

é•œåƒå†…å·²é¢„ç½®æ¥è‡ª `pmkol/easymosdns` çš„æ¨¡æ¿åˆ° `/opt/easymosdns`ï¼Œé¦–æ¬¡è¿è¡Œæ—¶ä¼šè‡ªåŠ¨å¤åˆ¶åˆ° `/etc/mosdns`ã€‚

### è§„åˆ™æ²¡æ›´æ–°ï¼Ÿ

1. ç¡®è®¤å·²è®¾ç½® `crontab` æˆ– `crontabcdn` ç¯å¢ƒå˜é‡
2. æ£€æŸ¥ `/etc/mosdns/rules/update*` æ˜¯å¦å­˜åœ¨ä¸”å¯æ‰§è¡Œ
3. æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼š`docker logs mosdns-x-docker`
4. è¿›å…¥å®¹å™¨æ£€æŸ¥ crontabï¼š`docker exec mosdns-x-docker cat /etc/crontabs/root`

### å¦‚ä½•æ‰‹åŠ¨æ›´æ–°è§„åˆ™ï¼Ÿ

```sh
# GitHub ç›´è¿æ›´æ–°
docker exec mosdns-x-docker /etc/mosdns/rules/update

# CDN åŠ é€Ÿæ›´æ–°
docker exec mosdns-x-docker /etc/mosdns/rules/update-cdn
```

### å¦‚ä½•æŸ¥çœ‹å½“å‰é•œåƒç‰ˆæœ¬ï¼Ÿ

```sh
# æŸ¥çœ‹é•œåƒæ ‡ç­¾
docker inspect ghcr.io/ywm/mosdns-x-docker:latest | grep -A 5 "Labels"

# æŸ¥çœ‹ mosdns ç‰ˆæœ¬
docker exec mosdns-x-docker /usr/bin/mosdns version
```

### å¦‚ä½•æ’æŸ¥é—®é¢˜ï¼Ÿ

1. å…ˆæŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼š`docker logs -f mosdns-x-docker`
2. æ£€æŸ¥é…ç½®æ–‡ä»¶ï¼š`docker exec mosdns-x-docker cat /etc/mosdns/config.yaml`
3. æ£€æŸ¥ crontabï¼š`docker exec mosdns-x-docker cat /etc/crontabs/root`
4. æ£€æŸ¥ç›®å½•ç»“æ„ï¼š`docker exec mosdns-x-docker ls -la /etc/mosdns`
5. è¿›å…¥å®¹å™¨è°ƒè¯•ï¼š`docker exec -it mosdns-x-docker sh`

### ä¸ºä»€ä¹ˆé€‰æ‹©æºç ç¼–è¯‘è€Œä¸æ˜¯é¢„ç¼–è¯‘ç‰ˆæœ¬ï¼Ÿ

- âœ… ç¬¬ä¸€æ—¶é—´è·å¾—ä¸Šæ¸¸æœ€æ–°åŠŸèƒ½å’Œä¿®å¤ï¼ˆä¸éœ€è¦ç­‰å¾… releaseï¼‰
- âœ… è‡ªåŠ¨è·Ÿè¸ªä¸Šæ¸¸è¦æ±‚çš„ Go ç‰ˆæœ¬
- âœ… å¯ä»¥é’ˆå¯¹ç‰¹å®š commit æ„å»º
- âœ… æ›´çµæ´»çš„æ„å»ºæ§åˆ¶

---

## ä¸å…¶ä»–é¡¹ç›®çš„å·®å¼‚

### ä¸ä¸Šæ¸¸ `pmkol/mosdns-x` çš„å…³ç³»

- ä¸Šæ¸¸æä¾›æ ¸å¿ƒ DNS å¼•æ“
- æœ¬é¡¹ç›®æä¾›å®¹å™¨åŒ–å°è£…ã€è‡ªåŠ¨æ„å»ºå’Œé…ç½®è‡ªåŠ¨åŒ–

### ä¸ `pmkol/easymosdns` çš„å…³ç³»

- æœ¬é•œåƒåœ¨æ„å»ºæ—¶å³é›†æˆå…¶æ¨¡æ¿ä¸è„šæœ¬
- æ— éœ€æ‰‹åŠ¨ä¸‹è½½ï¼Œå¼€ç®±å³ç”¨

### ä¸ `787a68/mosdns-x` çš„å…³ç³»

- Fork è‡ªè¯¥é¡¹ç›®ï¼Œæ„Ÿè°¢åŸä½œè€…çš„å·¥ä½œ
- ä¸»è¦å·®å¼‚ï¼š
  - ä½¿ç”¨æºç ç¼–è¯‘è€Œéé¢„ç¼–è¯‘ç‰ˆæœ¬
  - è‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨ä¸Šæ¸¸è¦æ±‚çš„ Go ç‰ˆæœ¬
  - æ¯æ—¥è‡ªåŠ¨æ„å»ºï¼Œå§‹ç»ˆä¿æŒæœ€æ–°
  - åŸºäº Ubuntu è€Œé Alpineï¼ˆæ›´å¥½çš„å…¼å®¹æ€§ï¼‰

---

## è®¸å¯ä¸è‡´è°¢

- **è®¸å¯**ï¼šè¯·å‚è€ƒä¸Šæ¸¸ä»“åº“çš„è®¸å¯æ¡æ¬¾
- **è‡´è°¢**ï¼š
  - [pmkol/mosdns-x](https://github.com/pmkol/mosdns-x) - æ ¸å¿ƒ DNS å¼•æ“
  - [pmkol/easymosdns](https://github.com/pmkol/easymosdns) - ä¼˜ç§€çš„é…ç½®æ¨¡æ¿å’Œè§„åˆ™
  - [787a68/mosdns-x](https://github.com/787a68/mosdns-x-docker) - åŸå§‹ Docker åŒ–é¡¹ç›®

---

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

å¦‚æœæ‚¨å‘ç°ä»»ä½•é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·ï¼š

1. æäº¤ [Issue](https://github.com/ywm/mosdns-x-docker/issues)
2. Fork æœ¬é¡¹ç›®å¹¶æäº¤ Pull Request
3. åœ¨ [Discussions](https://github.com/ywm/mosdns-x-docker/discussions) ä¸­è®¨è®º

---

## Star History

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ï¸ Star æ”¯æŒä¸€ä¸‹ï¼
